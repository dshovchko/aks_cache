# aks_cache v0.2.7f
# Partial caching web pages
# makss, Dmitry Shovchko
# http://github.com/dshovchko/aks_cache

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YToxMDp7czo3OiJ2ZXJzaW9uIjtzOjY6IjAuMi43ZiI7czo2OiJhdXRob3IiO3M6MjI6Im1h
a3NzLCBEbWl0cnkgU2hvdmNoa28iO3M6MTA6ImF1dGhvcl91cmkiO3M6Mzc6Imh0dHA6Ly9n
aXRodWIuY29tL2RzaG92Y2hrby9ha3NfY2FjaGUiO3M6MTE6ImRlc2NyaXB0aW9uIjtzOjI1
OiJQYXJ0aWFsIGNhY2hpbmcgd2ViIHBhZ2VzIjtzOjQ6InR5cGUiO3M6MToiMSI7czoxNToi
YWxsb3dfaHRtbF9oZWxwIjtzOjE6IjEiO3M6NDoibmFtZSI7czo5OiJha3NfY2FjaGUiO3M6
NDoiaGVscCI7czozOTc4OiI8ZGl2IGlkPSdha3MnPgo8ZGl2IHN0eWxlPSd0ZXh0LWFsaWdu
OnJpZ2h0Oyc+PGEgaHJlZj0nP2V2ZW50PWFrc19jYWNoZV90YWInPlBsdWdpbiBwcmVmZXJl
bmNlczwvYT48YnIgLz4KPGEgaHJlZj0iaHR0cDovL3RleHRwYXR0ZXJuLm9yZy51YS9wbHVn
aW5zL2Frc19jYWNoZSI+SG9tZXBhZ2U8L2E+PC9kaXY+CjxoMT5ha3NfY2FjaGUgLSBwYXJ0
aWFsIGNhY2hpbmcgd2ViIHBhZ2VzPC9oMT4KPGJyIC8+CiAgICA8aDI+U3VtbWFyeTwvaDI+
CgogICAgPHA+Q2FjaGluZyBhbGwgaW5zaWRlIDxjb2RlPiZsdDt0eHA6YWtzX2NhY2hlIGlk
PSJ1bmlxdWUgYmxvY2sgaWQiJmd0OzwvY29kZT4gQW55IGNvbnRlbnQgd2l0aCBUeFAgdGFn
cyA8Y29kZT4mbHQ7L3R4cDpha3NfY2FjaGUmZ3Q7PC9jb2RlPjwvcD4KCiAgICA8cD5Hb29k
IHByYWN0aWNlOgogICAgPC9wPjx1bD4KICAgICAgICA8bGk+Q2FjaGUgc29tZSBtZW51IGVs
ZW1lbnRzOyByZWNlbnQgYXJ0aWNsZXMgbGlzdDsgbGFzdCBhZGRlZCBhcnRpY2xlcyBsaXN0
OyBhbnkgcG9wdWxhciBsaXN0cy48L2xpPgogICAgICAgIDxsaT5DYWNoZSA8Y29kZT5jbG91
ZDwvY29kZT4gdGFnczwvbGk+CiAgICAgICAgPGxpPkNhY2hlIHNpdGUgPGNvZGU+bWFpbiBw
YWdlPC9jb2RlPiBvciBjYWNoZSBzb21lIOKAmHNsb3figJkgcGFnZXMgd2l0aCBtYW55IDxz
cGFuIGNsYXNzPSJjYXBzIj5UWFA8L3NwYW4+IHRhZ3MuPC9saT4KCiAgICAgICAgPGxpPkNh
Y2hlIG91dHB1dCBzb21lIHNsb3cgb3IgZGlmZmljdWx0IHRhZ3MuPC9saT4KICAgIDwvdWw+
CgogICAgPHA+QmFkIHByYWN0aWNlOgogICAgPC9wPjx1bD4KICAgICAgICA8bGk+Q2FjaGUg
c3RhdGljIGNvbnRlbnQgd2l0aG91dCBUeFAob3IgcGhwIGluY2x1ZGUpIHRhZ3M8L2xpPgog
ICAgICAgIDxsaT5GdWxsIGNhY2hlIGV2ZXJ5IHBhZ2U8L2xpPgogICAgICAgIDxsaT5DYWNo
ZSBzdGF0aWMgPGNvZGU+Ym9keTwvY29kZT4gZXZlcnkgcGFnZTwvbGk+CgogICAgPC91bD4K
CiAgICA8aDI+SW5zdGFsbGF0aW9uPC9oMj4KCiAgICA8b2w+CiAgICAgICAgPGxpPkluc3Rh
bGwgdGhpcyBwbHVnaW4uPC9saT4KICAgICAgICA8bGk+R28gdG8gRXh0ZW5zaW9uIC8gPGEg
aHJlZj0iP2V2ZW50PWFrc19jYWNoZV90YWIiPmFrc19jYWNoZSBUYWI8L2E+PC9saT4KICAg
IDwvb2w+CgogICAgPHA+PC9wPgoKCiAgICA8aDI+VGFnczwvaDI+CiAgICA8cD48Y29kZT4m
bHQ7dHhwOmFrc19jYWNoZSZndDs8L2NvZGU+IOKAkyBVc2VzIGluIHBhZ2UgdGVtcGxhdGVz
LCBmb3JtcywgYXJ0aWNsZXMuPC9wPgogICAgPHRhYmxlPgogICAgICAgIDx0Ym9keT48dHI+
CiAgICAgICAgICAgIDx0aD5hdHRyaWJ1dGVzPC90aD4KICAgICAgICAgICAgPHRoPmRlZmF1
bHQ8L3RoPgogICAgICAgICAgICA8dGg+c2FtcGxlPC90aD4KICAgICAgICAgICAgPHRoPmRl
c2NyaXB0aW9uPC90aD4KICAgICAgICA8L3RyPgogICAgICAgIDx0cj4KICAgICAgICAgICAg
PHRkPmlkPC90ZD4KICAgICAgICAgICAgPHRkPjxjb2RlPlsiUkVRVUVTVF9VUkkiXTwvY29k
ZT48L3RkPgogICAgICAgICAgICA8dGQ+4oCY4oCZPC90ZD4KICAgICAgICAgICAgPHRkPlVu
aXF1ZSBJRCBmb3IgZWFjaCBjYWNoZSBibG9jazwvdGQ+CiAgICAgICAgPC90cj4KICAgICAg
ICA8dHI+CiAgICAgICAgICAgIDx0ZD5ibG9jazwvdGQ+CiAgICAgICAgICAgIDx0ZD7igJji
gJk8L3RkPgogICAgICAgICAgICA8dGQ+4oCY4oCZPC90ZD4KICAgICAgICAgICAgPHRkPmZv
ciB1c2luZyB3aXRob3V0IDxjb2RlPmlkPC9jb2RlPiBhdHRyaWJ1dGU8L3RkPgogICAgICAg
IDwvdHI+CiAgICAgICAgPHRyPgogICAgICAgICAgICA8dGQ+aG91cjwvdGQ+CiAgICAgICAg
ICAgIDx0ZD4wPC90ZD4KICAgICAgICAgICAgPHRkPuKAmOKAmTwvdGQ+CiAgICAgICAgICAg
IDx0ZD5DYWNoZSB0aW1lID0gaG91cio2MCttaW48L3RkPgogICAgICAgIDwvdHI+CiAgICAg
ICAgPHRyPgogICAgICAgICAgICA8dGQ+bWluPC90ZD4KICAgICAgICAgICAgPHRkPjA8L3Rk
PgogICAgICAgICAgICA8dGQ+4oCY4oCZPC90ZD4KICAgICAgICAgICAgPHRkPuKAlC8v4oCU
PC90ZD4KICAgICAgICA8L3RyPgogICAgICAgIDx0cj4KICAgICAgICAgICAgPHRkPm5vcmVz
ZXQ8L3RkPgogICAgICAgICAgICA8dGQ+MDwvdGQ+CiAgICAgICAgICAgIDx0ZD4xPC90ZD4K
ICAgICAgICAgICAgPHRkPk5vIHJlc2V0IGNhY2hlIGZvciB0aGlzIGJsb2NrIOKAkyBpZ25v
cmUgb3B0aW9uIOKAnFJlc2V0IGNhY2hlIGlmIHNpdGUgd2FzIHVwZGF0ZWTigJ08L3RkPgog
ICAgICAgIDwvdHI+CiAgICAgICAgPHRyPgogICAgICAgICAgICA8dGQ+ZGlzYWJsZTwvdGQ+
CiAgICAgICAgICAgIDx0ZD4wPC90ZD4KICAgICAgICAgICAgPHRkPjE8L3RkPgogICAgICAg
ICAgICA8dGQ+RGlzYWJsZSBjYWNoZTwvdGQ+CiAgICAgICAgPC90cj4KICAgICAgICA8dHI+
CgogICAgICAgICAgICA8dGQ+ZGVidWc8L3RkPgogICAgICAgICAgICA8dGQ+MDwvdGQ+CiAg
ICAgICAgICAgIDx0ZD4xPC90ZD4KICAgICAgICAgICAgPHRkPjAgb3IgMTwvdGQ+CiAgICAg
ICAgPC90cj4KICAgIDwvdGJvZHk+PC90YWJsZT48YnIgLz4KCiAgICA8cD48Y29kZT4mbHQ7
dHhwOmFrc19jYWNoZV9kaXNhYmxlIC8mZ3Q7PC9jb2RlPiDigJMgVXNlZCA8c3Ryb25nPjxz
cGFuIGNsYXNzPSJjYXBzIj5PTkxZPC9zcGFuPjwvc3Ryb25nPiBpbnNpZGUgPGNvZGU+Jmx0
O3R4cDpha3NfY2FjaGUmZ3Q7PC9jb2RlPiDigKYgPGNvZGU+Jmx0Oy90eHA6YWtzX2NhY2hl
Jmd0OzwvY29kZT4gYmxvY2suPC9wPgoKCiAgICA8aDI+RXhhbXBsZTwvaDI+Cgo8cHJlPiZs
dDt0eHA6YWtzX2NhY2hlIGlkPSJibG9jazEiJmd0O1NvbWUgY29udGVudCBhbmQgdHhwIHRh
Z3MuLi4mbHQ7L3R4cDpha3NfY2FjaGUmZ3Q7CjwvcHJlPgoKICAgIDxwPkNhY2hlIG1lbnUg
ZWxlbWVudHMgcGVyIHNlY3Rpb248L3A+Cgo8cHJlPiZsdDt0eHA6YWtzX2NhY2hlIGlkPSdt
ZW51ICZsdDt0eHA6c2VjdGlvbiAvJmd0OycmZ3Q7CiZsdDtoMyZndDtUYWdzIGNsb3VkJmx0
Oy9oMyZndDsKJmx0O3Jzc191Y19jbG91ZCBzZWN0aW9uPScmbHQ7dHhwOnNlY3Rpb24gLyZn
dDsnIC8mZ3Q7CiZsdDtoMyZndDtMYXN0IGFkZGVkIGFydGljbGVzJmx0Oy9oMyZndDsKJmx0
O3R4cDphcnRpY2xlX2N1c3RvbSBmb3JtPSJ0Zl9leGNlcnB0IiBsaW1pdD0iMjAiIHNlY3Rp
b249JyZsdDt0eHA6c2VjdGlvbiAvJmd0Oycgc29ydD0iTGFzdE1vZCBkZXNjIiAvJmd0Owom
bHQ7L3R4cDpha3NfY2FjaGUmZ3Q7PC9wcmU+CjwvZGl2Pgo8IS0tICoqKiBCRUdJTiBQTFVH
SU4gQ1NTICoqKiAtLT4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KI2FrcyBoMSB7IGNvbG9y
OiAjMDAwMDAwOyBmb250OiAyMHB4IHNhbnMtc2VyaWY7fQojYWtzIGgyIHsgYm9yZGVyLWJv
dHRvbTogMXB4IHNvbGlkIGJsYWNrOyBwYWRkaW5nOjEwcHggMCAwOyBjb2xvcjogIzAwMDAw
MDsgZm9udDogMTVweCBzYW5zLXNlcmlmOyB9CiNha3MgdGFibGUge3dpZHRoOiAxMDAlOyBi
b3JkZXI6MXB4IHNvbGlkOyBib3JkZXItY29sb3I6I2RkZCAjMDAwICMwMDAgI2RkZDt9CiNh
a3MgdGggewogICAgYmFja2dyb3VuZC1jb2xvcjogI0UzRTNEQjsKICAgIGJvcmRlcjoxcHgg
c29saWQ7CiAgICBib3JkZXItY29sb3I6I2RkZCAjOTk5ICM4ODggI2RkZDsKICAgIHBhZGRp
bmc6IDEwcHggMXB4IDEwcHggMXB4Owp9CiNha3MgdGQgeyBiYWNrZ3JvdW5kLWNvbG9yOiAj
RjJGMkVEOyBwYWRkaW5nOiA1cHggMXB4IDVweCAxcHg7fQoKI2FrcyBwcmUgeyBwYWRkaW5n
OiA1cHg7CmxpbmUtaGVpZ2h0OiAxLjZlbTsKZm9udC1mYW1pbHk6IFZlcmRhbmEsIEFyaWFs
Owpmb250LXNpemU6IDEwMCU7CmJvcmRlcjogMXB4IGRhc2hlZCAjMDAwMDAwOwptYXJnaW46
IDEuNWVtIDA7Cn0KPC9zdHlsZT4KPCEtLSAqKiogRU5EIFBMVUdJTiBDU1MgKioqIC0tPgoi
O3M6NDoiY29kZSI7czoxMDM3MDoiaWYoQHR4cGludGVyZmFjZSA9PSAnYWRtaW4nKSB7CiAg
YWRkX3ByaXZzKCdha3NfY2FjaGVfdGFiJywgJzEsMicpOwogIHJlZ2lzdGVyX3RhYigiZXh0
ZW5zaW9ucyIsICJha3NfY2FjaGVfdGFiIiwgImFrc19jYWNoZSIpOwogIHJlZ2lzdGVyX2Nh
bGxiYWNrKCJha3NfY2FjaGVfdGFiIiwgImFrc19jYWNoZV90YWIiKTsKICBhZGRfcHJpdnMo
J3BsdWdpbl9wcmVmcy5ha3NfY2FjaGUnLCcxLDInKTsKICByZWdpc3Rlcl9jYWxsYmFjaygn
YWtzX2NhY2hlX3RhYicsICdwbHVnaW5fcHJlZnMuYWtzX2NhY2hlJyk7Cn0KCmZ1bmN0aW9u
IGFrc19jYWNoZV9kaXNhYmxlKCl7IGdsb2JhbCAkYWtzX2NhY2hlX2Rpc2FibGU7ICRha3Nf
Y2FjaGVfZGlzYWJsZT0xOyB9CgpmdW5jdGlvbiBfYWtzX2lzX3JlYWxseV93cml0YWJsZSgk
ZmlsZSkKewoJLy8gSWYgd2UncmUgb24gYSBVbml4IHNlcnZlciB3aXRoIHNhZmVfbW9kZSBv
ZmYgd2UgY2FsbCBpc193cml0YWJsZQoJaWYgKERJUkVDVE9SWV9TRVBBUkFUT1IgPT0gJy8n
IEFORCBAaW5pX2dldCgic2FmZV9tb2RlIikgPT0gRkFMU0UpCgl7CgkJcmV0dXJuIGlzX3dy
aXRhYmxlKCRmaWxlKTsKCX0KCgkvLyBGb3Igd2luZG93cyBzZXJ2ZXJzIGFuZCBzYWZlX21v
ZGUgIm9uIiBpbnN0YWxsYXRpb25zIHdlJ2xsIGFjdHVhbGx5CgkvLyB3cml0ZSBhIGZpbGUg
dGhlbiByZWFkIGl0LiAgQmFoLi4uCglpZiAoaXNfZGlyKCRmaWxlKSkKCXsKCQkkZmlsZSA9
IHJ0cmltKCRmaWxlLCAnLycpLicvJy5tZDUocmFuZCgxLDEwMCkpOwoKCQlpZiAoKCRmcCA9
IEBmb3BlbigkZmlsZSwgJ2FiJykpID09PSBGQUxTRSkKCQl7CgkJCXJldHVybiBGQUxTRTsK
CQl9CgoJCWZjbG9zZSgkZnApOwoJCUBjaG1vZCgkZmlsZSwgMDc3Nyk7CgkJQHVubGluaygk
ZmlsZSk7CgkJcmV0dXJuIFRSVUU7Cgl9CgllbHNlaWYgKCgkZnAgPSBAZm9wZW4oJGZpbGUs
ICdhYicpKSA9PT0gRkFMU0UpCgl7CgkJcmV0dXJuIEZBTFNFOwoJfQoKCWZjbG9zZSgkZnAp
OwoJcmV0dXJuIFRSVUU7Cn0KCmZ1bmN0aW9uIF9ha3NfY2FjaGVfd3JpdGUoJGhpZCwgJGRh
dGEsICRleHBpcmUgPSAwKQp7CglnbG9iYWwgJHByZWZzOwoKCSRjYWNoZV9wYXRoID0gdHhw
YXRoLiRwcmVmc1snYWtzX2NhY2hlX3BhdGgnXTsKCglpZiAoICEgaXNfZGlyKCRjYWNoZV9w
YXRoKSBPUiAhIF9ha3NfaXNfcmVhbGx5X3dyaXRhYmxlKCRjYWNoZV9wYXRoKSkKCXsKCQly
ZXR1cm47Cgl9CgoJJGNhY2hlX3BhdGggLj0gJGhpZDsKCglpZiAoICEgJGZwID0gQGZvcGVu
KCRjYWNoZV9wYXRoLCAnd2InKSkKCXsKCQllY2hvICI8IS0tVW5hYmxlIHRvIHdyaXRlIGNh
Y2hlIGZpbGU6ICIuJGNhY2hlX3BhdGguIi0tPiI7CgkJcmV0dXJuOwoJfQoKCWlmICgkZXhw
aXJlID09IDApCgl7CgkJJGV4cGlyZSA9IHRpbWUoKSArICgkcHJlZnNbJ2Frc19jYWNoZV90
aW1lJ10gKiA2MCk7Cgl9CgoJaWYgKGZsb2NrKCRmcCwgTE9DS19FWCkpCgl7CgkJZndyaXRl
KCRmcCwgJGV4cGlyZS4nVFMtLS0+Jy4kZGF0YSk7CgkJZmxvY2soJGZwLCBMT0NLX1VOKTsK
CX0KCWVsc2UKCXsKCQllY2hvICI8IS0tVW5hYmxlIHRvIHNlY3VyZSBhIGZpbGUgbG9jayBm
b3IgZmlsZSBhdDogIi4kY2FjaGVfcGF0aC4iLS0+IjsKCQlyZXR1cm47Cgl9CglmY2xvc2Uo
JGZwKTsKCUBjaG1vZCgkY2FjaGVfcGF0aCwgMDc3Nyk7Cgp9CgpmdW5jdGlvbiBfYWtzX2Nh
Y2hlX3JlYWQoJGhpZCkKewoJZ2xvYmFsICRwcmVmczsKCgkkY2FjaGVfcGF0aCA9IHR4cGF0
aC4kcHJlZnNbJ2Frc19jYWNoZV9wYXRoJ107CgoJaWYgKCAhIGlzX2RpcigkY2FjaGVfcGF0
aCkgT1IgISBfYWtzX2lzX3JlYWxseV93cml0YWJsZSgkY2FjaGVfcGF0aCkpCgl7CgkJcmV0
dXJuIGZhbHNlOwoJfQoKCSRmaWxlcGF0aCA9ICRjYWNoZV9wYXRoLiRoaWQ7CgoJaWYgKCAh
IEBmaWxlX2V4aXN0cygkZmlsZXBhdGgpKQoJewoJCXJldHVybiBmYWxzZTsKCX0KCglpZiAo
ICEgJGZwID0gQGZvcGVuKCRmaWxlcGF0aCwgJ3JiJykpCgl7CgkJcmV0dXJuIGZhbHNlOwoJ
fQoKCWZsb2NrKCRmcCwgTE9DS19TSCk7CgoJJGNhY2hlID0gJyc7CglpZiAoZmlsZXNpemUo
JGZpbGVwYXRoKSA+IDApCgl7CgkJJGNhY2hlID0gZnJlYWQoJGZwLCBmaWxlc2l6ZSgkZmls
ZXBhdGgpKTsKCX0KCglmbG9jaygkZnAsIExPQ0tfVU4pOwoJZmNsb3NlKCRmcCk7CgoJLy8g
U3RyaXAgb3V0IHRoZSBlbWJlZGRlZCB0aW1lc3RhbXAKCWlmICggISBwcmVnX21hdGNoKCIv
KFxkK1RTLS0tPikvIiwgJGNhY2hlLCAkbWF0Y2gpKQoJewoJCXJldHVybiBmYWxzZTsKCX0K
CgkvLyBIYXMgdGhlIGZpbGUgZXhwaXJlZD8gSWYgc28gd2UnbGwgZGVsZXRlIGl0LgoJaWYg
KHRpbWUoKSA+PSB0cmltKHN0cl9yZXBsYWNlKCdUUy0tLT4nLCAnJywgJG1hdGNoWycxJ10p
KSkKCXsKCQlAdW5saW5rKCRmaWxlcGF0aCk7CgkJcmV0dXJuIGZhbHNlOwoJfQoKCXJldHVy
biBzdHJfcmVwbGFjZSgkbWF0Y2hbJzAnXSwgJycsICRjYWNoZSk7Cn0KCmZ1bmN0aW9uIF9h
a3NfY2FjaGVfcmVzZXQoJGNsZWFyID0gZmFsc2UpCnsKCWdsb2JhbCAkcHJlZnM7CgoJJGNh
Y2hlX3BhdGggPSB0eHBhdGguJHByZWZzWydha3NfY2FjaGVfcGF0aCddOwoKCWlmICggISBp
c19kaXIoJGNhY2hlX3BhdGgpIE9SICEgX2Frc19pc19yZWFsbHlfd3JpdGFibGUoJGNhY2hl
X3BhdGgpKQoJewoJCXJldHVybjsKCX0KCgkkZGlySGFuZGxlID0gQG9wZW5kaXIoJGNhY2hl
X3BhdGgpOwoKCXdoaWxlKCBmYWxzZSAhPT0gKCAkZmlsZSA9IEByZWFkZGlyKCRkaXJIYW5k
bGUpICkgKQoJewoJCWlmICgkY2xlYXIgPT09IGZhbHNlICYmIHN1YnN0cigkZmlsZSwgMCwg
MSkgPT0gJ0AnKQoJCXsKCQkJY29udGludWU7CgkJfQoJCWlmICggJGZpbGUgIT0gJy4nICYm
ICRmaWxlICE9ICcuLicgJiYgJGZpbGUgIT0gJ2luZGV4Lmh0bWwnKQoJCXsKCQkJJHRtcFBh
dGggPSAkY2FjaGVfcGF0aC4kZmlsZTsKCgkJCWlmICggISBpc19kaXIoJHRtcFBhdGgpICkK
CQkJewoJCQkJQHVubGluaygkdG1wUGF0aCk7CgkJCX0KCQl9Cgl9CgoJY2xvc2VkaXIoJGRp
ckhhbmRsZSk7Cn0KCmZ1bmN0aW9uIGFrc19jYWNoZSgkYXR0cywkdGhpbmc9JycpIHsKCWds
b2JhbCAkcHJlZnMsICRha3NfY2FjaGVfZGlzYWJsZTsKCWV4dHJhY3QobEF0dHMoYXJyYXko
CgkJJ2Jsb2NrJwkJPT4gJycsCgkJJ2lkJwkJPT4gJF9TRVJWRVJbIlJFUVVFU1RfVVJJIl0s
CgkJJ2hvdXInCQk9PiAwLAoJCSdtaW4nCQk9PiAwLAoJCSdub3Jlc2V0Jwk9PiAnJywKCQkn
ZGlzYWJsZScJPT4gMCwKCQknZGVidWcnCQk9PiAoKHN0cnBvcygkcHJlZnNbJ2Frc19jYWNo
ZV9vcHQnXSwnZGVidWcnKT09PWZhbHNlKT8gMDoxKQoJKSwkYXR0cykpOwoKICAgICAgICAk
c3RhcnQgPSBnZXRtaWNyb3RpbWUoKTsKCWlmKCAhKHN0cnBvcygkcHJlZnNbJ2Frc19jYWNo
ZV9vcHQnXSwnZGlzYWJsZScpPT09ZmFsc2UpIHx8ICRkaXNhYmxlKXsgcmV0dXJuIHBhcnNl
KCR0aGluZyk7IH0KCSRwcnI9aXNfbG9nZ2VkX2luKCk7CglpZiggIShzdHJwb3MoJHByZWZz
Wydha3NfY2FjaGVfb3B0J10sJ2Rpc19hZG0nKT09PWZhbHNlKSYmICRwcnJbJ3ByaXZzJ109
PTEgKXsgcmV0dXJuIHBhcnNlKCR0aGluZyk7IH0KCWlmKCAhKHN0cnBvcygkcHJlZnNbJ2Fr
c19jYWNoZV9vcHQnXSwnZGlzX3VzZXJzJyk9PT1mYWxzZSkmJiAkcHJyICl7IHJldHVybiBw
YXJzZSgkdGhpbmcpOyB9CgoJaWYoICEoc3RycG9zKCRwcmVmc1snYWtzX2NhY2hlX29wdCdd
LCdyZXNldCcpPT09ZmFsc2UpJiYgKCRwcmVmc1snYWtzX2NhY2hlX3NpdGVfbGFzdG1vZCdd
IT0kcHJlZnNbJ2xhc3Rtb2QnXSkgKXsKCQlzYWZlX3VwZGF0ZSgidHhwX3ByZWZzIiwgInZh
bD0nIi4kcHJlZnNbJ2xhc3Rtb2QnXS4iJyIsICJuYW1lPSdha3NfY2FjaGVfc2l0ZV9sYXN0
bW9kJyIpOwoJCWlmICggc3RycG9zKCRwcmVmc1snYWtzX2NhY2hlX29wdCddLCdpbmZpbGUn
KT09PWZhbHNlICkKCQl7CgkJCXNhZmVfZGVsZXRlKCJha3NfY2FjaGUiLCJpbmZvcyBub3Qg
bGlrZSAnbm9yZXNldC0lJyIpOwoJCX0KCQllbHNlCgkJewoJCQlfYWtzX2NhY2hlX3Jlc2V0
KCk7CgkJfQoJCSRwcmVmc1snYWtzX2NhY2hlX3NpdGVfbGFzdG1vZCddPSRwcmVmc1snbGFz
dG1vZCddOwoJfQoJaWYoJG5vcmVzZXQpeyAkbm9yZXNldD0nbm9yZXNldC0nOyB9CgkkZGlm
Zj0kaG91cio2MCskbWluOwoJaWYoISRkaWZmKXsKCQkkZGlmZj0kcHJlZnNbJ2Frc19jYWNo
ZV90aW1lJ107Cgl9CgkkdHRsMj10aW1lKCkrJGRpZmYqNjA7CgkkaGFzaD1tZDUoJG5vcmVz
ZXQuJGJsb2NrLiRpZCk7CgkkaWQyPW15c3FsX3JlYWxfZXNjYXBlX3N0cmluZygkbm9yZXNl
dC4kYmxvY2suJGlkKTsKCSRhY3Q9ImZyb20gY2FjaGUiOwoKCWlmICggc3RycG9zKCRwcmVm
c1snYWtzX2NhY2hlX29wdCddLCdpbmZpbGUnKT09PWZhbHNlICkKCXsKCQkkcnMgPSBzYWZl
X3JvdygidHRsLCBkYXRhIiwgImFrc19jYWNoZSIsICJoaWQ9JyRoYXNoJyIpOwoKCQlpZigk
cnMpewoJCQlleHRyYWN0KCRycyk7CgkJCWlmKCR0dGw8dGltZSgpICl7CgkJCQkkZGF0YT1w
YXJzZSgkdGhpbmcpOwoJCQkJJGRhdGEyPW15c3FsX3JlYWxfZXNjYXBlX3N0cmluZygkZGF0
YSk7CgkJCQkkYWN0PSJ1cGRhdGUgY2FjaGUiOwoJCQkJc2FmZV91cGRhdGUoImFrc19jYWNo
ZSIsICJ0dGw9JHR0bDIsIGRhdGE9JyRkYXRhMicsIGluZm9zPSckaWQyfCRkaWZmfCIuc3Ry
bGVuKCRkYXRhKS4iJyIsICJoaWQ9JyRoYXNoJyIpOwoJCQl9CgkJfWVsc2V7CgkJCSRkYXRh
PXBhcnNlKCR0aGluZyk7CgkJCSRkYXRhMj1teXNxbF9yZWFsX2VzY2FwZV9zdHJpbmcoJGRh
dGEpOwoJCQkkYWN0PSJpbnNlcnQgaW50byBjYWNoZSI7CgkJCXNhZmVfaW5zZXJ0KCJha3Nf
Y2FjaGUiLCAiaGlkPSckaGFzaCcsIHR0bD0kdHRsMiwgZGF0YT0nJGRhdGEyJywgaW5mb3M9
JyRpZDJ8JGRpZmZ8Ii5zdHJsZW4oJGRhdGEpLiInIik7CgkJfQoJfQoJZWxzZQoJewogICAg
ICAgICAgICAgICAgaWYoJG5vcmVzZXQpIHsKCQkgICAgJGhhc2ggPSAiQCIuJGhhc2g7CgkJ
fQoJCWlmICgoJGRhdGEgPSBfYWtzX2NhY2hlX3JlYWQoJGhhc2gpKSA9PT0gZmFsc2UpewoJ
CQkkZGF0YT1wYXJzZSgkdGhpbmcpOwoJCQlfYWtzX2NhY2hlX3dyaXRlKCRoYXNoLCAkZGF0
YSwgJHR0bDIpOwoJCQkkYWN0PSJpbnNlcnQgaW50byBjYWNoZSI7CgkJfQoJfQoKCSR0aW1l
ID0gZ2V0bWljcm90aW1lKCkgLSAkc3RhcnQ7CglpZigkZGVidWcpe3JldHVybiAiPCEtLXR4
cDpha3NfY2FjaGUgYmxvY2s9JyRibG9jaycgaWQ9JyRpZCcgYWN0aW9uPSckYWN0JyB0dGw9
JyRkaWZmIG1pbnV0ZXMnIGhhc2g9JyRoYXNoJyAtLT4iLiRkYXRhLiI8IS0tL3R4cDpha3Nf
Y2FjaGUgKCR0aW1lKS0tPiI7IH0KCXJldHVybiAkZGF0YTsKfQoKCmZ1bmN0aW9uIGFrc19j
YWNoZV90YWIoJGV2ZW50LCAkc3RlcCkgewoJZ2xvYmFsICRwcmVmczsKCgkkdGNoZWNrID0g
Z2V0Um93cygiU0hPVyBUQUJMRVMgTElLRSAnIi5QRlguImFrc19jYWNoZSciKTsKCWlmKCEk
dGNoZWNrKSB7CgkJJHFjPSJDUkVBVEUgVEFCTEUgYCIuUEZYLiJha3NfY2FjaGVgICgiOwoJ
CSRxYy49IDw8PEVPRgoJCWBoaWRgIGJpbmFyeSgzMikgTk9UIE5VTEwgZGVmYXVsdCAnJywK
CQlgdHRsYCBiaWdpbnQoMjApIHVuc2lnbmVkIGRlZmF1bHQgJzAnLAoJCWBkYXRhYCBtZWRp
dW10ZXh0LAoJCWBpbmZvc2AgdmFyY2hhcigyNTUpIGRlZmF1bHQgJycsCgkJUFJJTUFSWSBL
RVkgIChgaGlkYCksCgkJS0VZIGBpbmRfdHRsYCAoYHR0bGApCgkJKSBFTkdJTkU9TXlJU0FN
IERFRkFVTFQgQ0hBUlNFVD11dGY4OwpFT0Y7CgkJc2FmZV9xdWVyeSgkcWMpOwoJfQoKCWlm
KCFpc3NldCgkcHJlZnNbJ2Frc19jYWNoZV90aW1lJ10pKXsKCQkkcnMgPSBzYWZlX2luc2Vy
dCgndHhwX3ByZWZzJywgIm5hbWU9J2Frc19jYWNoZV90aW1lJywgdmFsPSc2MCcsIHByZWZz
X2lkPScxJyIpOwoJfQoJJGlzbnc9ZmFsc2U7CglpZighaXNzZXQoJHByZWZzWydha3NfY2Fj
aGVfcGF0aCddKSl7CgkJJHJzID0gc2FmZV9pbnNlcnQoJ3R4cF9wcmVmcycsICJuYW1lPSdh
a3NfY2FjaGVfcGF0aCcsIHZhbD0nL2Frc19jYWNoZS8nLCBwcmVmc19pZD0nMSciKTsKCX0g
ZWxzZSB7CgkJJGNhY2hlX3BhdGg9dHhwYXRoLiRwcmVmc1snYWtzX2NhY2hlX3BhdGgnXTsK
CQlpZiAoICFpc19kaXIoJGNhY2hlX3BhdGgpIE9SICFfYWtzX2lzX3JlYWxseV93cml0YWJs
ZSgkY2FjaGVfcGF0aCkpCgkJewoJCSAgICAkaXNudz10cnVlOwoJCX0KCX0KCWlmKCFpc3Nl
dCgkcHJlZnNbJ2Frc19jYWNoZV9vcHQnXSkpewoJCSRycyA9IHNhZmVfaW5zZXJ0KCd0eHBf
cHJlZnMnLCAibmFtZT0nYWtzX2NhY2hlX29wdCcsdmFsPScnLCBwcmVmc19pZD0nMSciKTsK
CQkkcXE9Jyc7Cgl9ZWxzZSB7CgkJJHFxPSRwcmVmc1snYWtzX2NhY2hlX29wdCddOwoJfQoJ
aWYoIWlzc2V0KCRwcmVmc1snYWtzX2NhY2hlX3NpdGVfbGFzdG1vZCddKSl7CgkJJHJzID0g
c2FmZV9pbnNlcnQoJ3R4cF9wcmVmcycsICJuYW1lPSdha3NfY2FjaGVfc2l0ZV9sYXN0bW9k
JywgdmFsPScnLCBwcmVmc19pZD0nMSciKTsKCX0KCglzYWZlX2RlbGV0ZSgiYWtzX2NhY2hl
IiwidHRsPFVOSVhfVElNRVNUQU1QKCkiKTsKCiAgICAgICAgaWYgKHBzKCJzYXZlIikpIHsK
CQlwYWdldG9wKCJha3NfY2FjaGUgUHJlZnMiLCAiUHJlZmVyZW5jZXMgU2F2ZWQiKTsKCQlz
YWZlX3VwZGF0ZSgidHhwX3ByZWZzIiwgInZhbCA9ICciLmFkZHNsYXNoZXMocHMoJ2Frc19j
YWNoZV90aW1lJykpLiInIiwibmFtZSA9ICdha3NfY2FjaGVfdGltZScgYW5kIHByZWZzX2lk
ID0nMSciKTsKCQkkcGF0aD1wcygnYWtzX2NhY2hlX3BhdGgnKTsKCQlpZiAoc3Vic3RyKCRw
YXRoLDAsMSkgIT0gIi8iKSAkcGF0aCA9ICIvIi4kcGF0aDsKCQlpZiAoc3Vic3RyKCRwYXRo
LC0xKSAhPSAiLyIpICRwYXRoIC49ICIvIjsKCQlzYWZlX3VwZGF0ZSgidHhwX3ByZWZzIiwg
InZhbCA9ICciLmFkZHNsYXNoZXMoJHBhdGgpLiInIiwibmFtZSA9ICdha3NfY2FjaGVfcGF0
aCcgYW5kIHByZWZzX2lkID0nMSciKTsKCQlpZihpc3NldCgkX1BPU1RbJ2Frc19jYWNoZV9v
cHQnXSkpeyAkb3B0PWltcGxvZGUoJywnLCRfUE9TVFsnYWtzX2NhY2hlX29wdCddKTsgfWVs
c2V7ICRvcHQ9IiI7IH0KCQlzYWZlX3VwZGF0ZSgidHhwX3ByZWZzIiwgInZhbCA9ICciLmFk
ZHNsYXNoZXMoJG9wdCkuIiciLCJuYW1lID0gJ2Frc19jYWNoZV9vcHQnIGFuZCBwcmVmc19p
ZCA9JzEnIik7CgkJaGVhZGVyKCJMb2NhdGlvbjogaW5kZXgucGhwP2V2ZW50PWFrc19jYWNo
ZV90YWIiKTsKICAgICAgICB9IGVsc2UgewoJCXBhZ2V0b3AoImFrc19jYWNoZSBQcmVmcyIp
OwogICAgICAgIH0KCWlmKHBzKCJyZXNldF9jYWNoZSIpKXsKCQlfYWtzX2NhY2hlX3Jlc2V0
KCk7CgkJc2FmZV9kZWxldGUoImFrc19jYWNoZSIsImluZm9zIG5vdCBsaWtlICdub3Jlc2V0
LSUnIik7Cgl9CglpZihwcygiY2xlYXJfY2FjaGUiKSl7CgkJX2Frc19jYWNoZV9yZXNldCh0
cnVlKTsKCQlzYWZlX3F1ZXJ5KCJ0cnVuY2F0ZSB0YWJsZSBgIi5QRlguImFrc19jYWNoZWAi
KTsKCX0KCSRHTE9CQUxTWydwcmVmcyddID0gZ2V0X3ByZWZzKCk7CgkkcWNvdW50PXNhZmVf
Y291bnQoJ2Frc19jYWNoZScsJzE9MScpOwoKICAgICAgICBlY2hvICc8dGFibGUgd2lkdGg9
IjEwMCUiIGJvcmRlcj0iMCI+PHRyIHZhbGlnbj0idG9wIj48dGQgd2lkdGg9IjM1JSI+Jy5z
dGFydFRhYmxlKCdsaXN0JykuCiAgICAgICAgZm9ybSgKICAgICAgICB0cih0ZGNzKCI8ZGl2
IHN0eWxlPSd0ZXh0LWFsaWduOnJpZ2h0Oyc+WzxhIGhyZWY9Jz9ldmVudD1wbHVnaW4mc3Rl
cD1wbHVnaW5faGVscCZuYW1lPWFrc19jYWNoZSc+UGx1Z2luIGhlbHA8L2E+XTwvZGl2PiIu
aGVkKCJha3NfY2FjaGUgUHJlZmVyZW5jZXMiLDEpLDMpKS4KICAgICAgICB0cih0ZGEoZ1R4
dCgnRGlzYWJsZSBha3NfY2FjaGU6JyksICcgc3R5bGU9InRleHQtYWxpZ246cmlnaHQ7dmVy
dGljYWwtYWxpZ246bWlkZGxlIicpLnRkYShjaGVja2JveCgnYWtzX2NhY2hlX29wdFtdJywn
ZGlzYWJsZScsKChzdHJwb3MoJHFxLCdkaXNhYmxlJyk9PT1mYWxzZSk/IDA6MSkgKSwgJyAn
KSApLgogICAgICAgIHRyKHRkYShnVHh0KCdEZWJ1ZzonKSwgJyBzdHlsZT0idGV4dC1hbGln
bjpyaWdodDt2ZXJ0aWNhbC1hbGlnbjptaWRkbGUiJykudGRhKGNoZWNrYm94KCdha3NfY2Fj
aGVfb3B0W10nLCdkZWJ1ZycsKChzdHJwb3MoJHFxLCdkZWJ1ZycpPT09ZmFsc2UpPyAwOjEp
ICksICcgJykgKS4KICAgICAgICB0cih0ZGEoZ1R4dCgnPGI+UmVzZXQgY2FjaGU8L2I+IGlm
IHNpdGUgd2FzIHVwZGF0ZWQ6JyksICcgc3R5bGU9InRleHQtYWxpZ246cmlnaHQ7dmVydGlj
YWwtYWxpZ246bWlkZGxlIicpLnRkYShjaGVja2JveCgnYWtzX2NhY2hlX29wdFtdJywncmVz
ZXQnLCgoc3RycG9zKCRxcSwncmVzZXQnKT09PWZhbHNlKT8gMDoxKSApLCAnICcpICkuCiAg
ICAgICAgdHIodGRhKGdUeHQoJ0Rpc2FibGUgY2FjaGUgZm9yIGFkbWluOicpLCAnIHN0eWxl
PSJ0ZXh0LWFsaWduOnJpZ2h0O3ZlcnRpY2FsLWFsaWduOm1pZGRsZSInKS50ZGEoY2hlY2ti
b3goJ2Frc19jYWNoZV9vcHRbXScsJ2Rpc19hZG0nLCgoc3RycG9zKCRxcSwnZGlzX2FkbScp
PT09ZmFsc2UpPyAwOjEpICksICcgJykgKS4KICAgICAgICB0cih0ZGEoZ1R4dCgnRGlzYWJs
ZSBjYWNoZSBmb3IgdXNlcnM6JyksICcgc3R5bGU9InRleHQtYWxpZ246cmlnaHQ7dmVydGlj
YWwtYWxpZ246bWlkZGxlIicpLnRkYShjaGVja2JveCgnYWtzX2NhY2hlX29wdFtdJywnZGlz
X3VzZXJzJywoKHN0cnBvcygkcXEsJ2Rpc191c2VycycpPT09ZmFsc2UpPyAwOjEpICksICcg
JykgKS4KICAgICAgICB0cih0ZGEoZ1R4dCgnQ2FjaGUgaW4gZmlsZTonKSwgJyBzdHlsZT0i
dGV4dC1hbGlnbjpyaWdodDt2ZXJ0aWNhbC1hbGlnbjptaWRkbGUiJykudGRhKGNoZWNrYm94
KCdha3NfY2FjaGVfb3B0W10nLCdpbmZpbGUnLCgoc3RycG9zKCRxcSwnaW5maWxlJyk9PT1m
YWxzZSk/IDA6MSkgKSwgJyAnKSApLgogICAgICAgIHRyKHRkYShnVHh0KCdEZWZhdWx0IGNh
Y2hlIHRpbWUgaW4gbWludXRlczonKSwgJyBzdHlsZT0idGV4dC1hbGlnbjpyaWdodDt2ZXJ0
aWNhbC1hbGlnbjptaWRkbGUiJykudGRhKGZJbnB1dCgidGV4dCIsImFrc19jYWNoZV90aW1l
IiwkcHJlZnNbJ2Frc19jYWNoZV90aW1lJ10sJ2VkaXQnLCcnLCcnLCcxMCcpLCAnICcpIC50
ZGEoIiIpICkuCiAgICAgICAgdHIodGRhKGdUeHQoJ0NhY2hlIHBhdGg6JyksICcgc3R5bGU9
InRleHQtYWxpZ246cmlnaHQ7dmVydGljYWwtYWxpZ246bWlkZGxlIicpLnRkYShmSW5wdXQo
InRleHQiLCJha3NfY2FjaGVfcGF0aCIsJHByZWZzWydha3NfY2FjaGVfcGF0aCddLCdlZGl0
JywnJywnJywnMjAnKSwgJyAnKSAudGRhKCIiKSApLgoJKCgkaXNudz09PXRydWUpP3RyKHRk
YShnVHh0KCdDYWNoZSBwYXRoIGlzIG5vdCB3cml0YWJsZSEhIScpLCAnIGNvbHNwYW49IjIi
IGNsYXNzPSJub3Qtb2siJykgKTonJykuCiAgICAgICAgdHIoCgkJdGRhKGZJbnB1dCgic3Vi
bWl0Iiwic2F2ZSIsZ1R4dCgic2F2ZV9idXR0b24iKSwicHVibGlzaCIpLmVJbnB1dCgiYWtz
X2NhY2hlX3RhYiIpLnNJbnB1dCgnc2F2ZXByZWZzJyksICIgY2xhc3M9XCJub2xpbmVcIiIp
CgkpLgoKCXRyKHRkYSgnPGJyIC8+PGJyIC8+PGJyIC8+JykudGRhKCIgIikpLgoKCXRyKAog
ICAgICAgICAgICB0ZGEoJ0l0ZW1zIGluIGNhY2hlOicsICcgc3R5bGU9InRleHQtYWxpZ246
cmlnaHQ7dmVydGljYWwtYWxpZ246bWlkZGxlIicpLnRkYSgiPGI+JHFjb3VudDwvYj4iKQoJ
KS4KCXRyKAogICAgICAgICAgICB0ZGEoZklucHV0KCJzdWJtaXQiLCJjbGVhcl9jYWNoZSIs
IkNsZWFyIGFsbCBjYWNoZSIsInB1Ymxpc2giKSkudGRhKGZJbnB1dCgic3VibWl0IiwicmVz
ZXRfY2FjaGUiLCJSZXNldCBjYWNoZSIsInB1Ymxpc2giKSkKCSkpLiBlbmRUYWJsZSgpOwoK
CSRxaW5mb3M9c2FmZV9jb2x1bW4oImluZm9zIiwgImFrc19jYWNoZSIsICIxPTEgb3JkZXIg
YnkgaW5mb3MgYXNjIik7CgllY2hvICc8L3RkPjx0ZD48dGFibGUgd2lkdGg9Ijk4JSI+PHRy
Pjx0aD5jYWNoZSBibG9ja19pZDwvdGg+PHRoPnR0bChtaW51dGVzKTwvdGg+PHRoPnNpemUo
Ynl0ZXMpPC90aD48L3RyPic7Cglmb3JlYWNoKCRxaW5mb3MgYXMgJHFzKXsgJHFzPXByZWdf
cmVwbGFjZSgnL1x8LycsICc8L3RkPjx0ZCBzdHlsZT0idGV4dC1hbGlnbjpyaWdodDsiPics
ICRxcyk7IGVjaG8gIjx0cj48dGQ+JHFzPC90ZD48L3RyPiI7IH0KCWVjaG8gIjwvdGFibGU+
PC90ZD48L3RyPjwvdGFibGU+IjsKfQoiO3M6MzoibWQ1IjtzOjMyOiIyOTkyY2Y5MmI0M2Nk
NmNkM2I5YzI1NmFiMWYyMmJjMSI7fQ==
